---
title: Jobs
description: Asynchronous tasks.
---

Documentation: <https://laravel.com/docs/9.x/queues>.

## Create a new Job

```bash
php artisan make:job ProcessHeavyServerTask
```

## Usage

```php title="app/Jobs/ProcessHeavyServerTask.php"
<?php

namespace App\Jobs;

use Illuminate\Bus\Queueable;
use Illuminate\Contracts\Queue\ShouldQueue;
use Illuminate\Foundation\Bus\Dispatchable;
use Illuminate\Queue\InteractsWithQueue;
use Illuminate\Queue\SerializesModels;
use Log;

class ProcessHeavyServerTask implements ShouldQueue
{
  use Dispatchable;
  use InteractsWithQueue;
  use Queueable;
  use SerializesModels;

  /**
   * Create a new job instance.
   */
  public function __construct(
    public mixed $param,
    public mixed $param_alt,
  ) {
  }

  /**
   * Execute the job.
   */
  public function handle()
  {
    // Very heavy server task...

    Log::debug('Success on job '.now());
  }

  public function failed(\Throwable $exception)
  {
    Log::error('Error on job');
  }
}
```

## Call

```php title="app/Http/Controller/MainController.php"
<?php

class MainController extends Controller
{
  public function index()
  {
    $param = [];
    $param_alt = true;

    ProcessHeavyServerTask::dispatch($param, $param_alt);
  }
}
```

## Execute

If you change anything into your job, you have to re-run the command. And for EVERY deployment, you have to restart `supervisor`.

### Local

```bash
php artisan queue:work
```

### Server

```bash
php artisan queue:table
```

```bash
php artisan migrate
```

Install `supervisor`.

:::tip

Replace `app-name` with the name of your application.

:::

```bash
sudo apt install supervisor -y
```

```bash
touch /etc/supervisor/conf.d/app-name.conf
```

```bash title="supervisor/app-name.conf"
[program:app-name]
process_name=%(program_name)s_%(process_num)02d
command=php8.1 /home/ubuntu/www/app-name/artisan queue:work database --sleep=3 --tries=3
autostart=true
autorestart=true
user=ubuntu
numprocs=1
redirect_stderr=true
stdout_logfile=/home/ubuntu/www/app-name/storage/logs/worker.log
```

In `/etc/supervisor/supervisord.conf`, check if this lien is already present.

```bash title="/etc/supervisor/supervisord.conf"
[include]
files = /etc/supervisor/conf.d/*.conf
```

Restart supervisor worker with this command.

```bash
sudo supervisorctl restart app-name:*
```
